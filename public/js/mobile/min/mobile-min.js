function clone(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}angular.module("YYYG",["ionic","YYYG.filters"]).config(["$stateProvider","$httpProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,o,r){r.backButton.text("返回").icon("ion-chevron-left"),r.navBar.alignTitle("center"),e.state("tab",{url:"/tab","abstract":!0,templateUrl:"/public/tpls/mobile/tab/tabs.html",controller:"TabCtrl"}).state("tab.index",{url:"/index",views:{"tab-index":{templateUrl:"/public/tpls/mobile/tab/tab-index.html",controller:"IndexCtrl"}}}).state("tab.result",{url:"/result",views:{"tab-result":{templateUrl:"/public/tpls/mobile/tab/tab-result.html",controller:"ResultCtrl"}}}).state("tab.show",{url:"/show",views:{"tab-show":{templateUrl:"/public/tpls/mobile/tab/tab-show.html",controller:"ShowCtrl"}}}).state("tab.cart",{url:"/cart",views:{"tab-cart":{templateUrl:"/public/tpls/mobile/tab/tab-cart.html",controller:"CartCtrl"}}}).state("tab.profile",{url:"/profile",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/tab/tab-profile.html",controller:"ProfileCtrl"}}}).state("tab.index-show-page",{url:"/index/show-product-{pid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-index":{templateUrl:"/public/tpls/mobile/tab/tab-show.html",controller:"ShowCtrl"}}}).state("tab.result-show-page",{url:"/result/show-product-{pid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-result":{templateUrl:"/public/tpls/mobile/tab/tab-show.html",controller:"ShowCtrl"}}}).state("tab.show-show-page",{url:"/show/show-product-{pid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-show":{templateUrl:"/public/tpls/mobile/tab/tab-show.html",controller:"ShowCtrl"}}}).state("tab.profile-show-page",{url:"/profile/show-product-{pid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/tab/tab-show.html",controller:"ShowCtrl"}}}).state("tab.index-history",{url:"/index/history-{pid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-index":{templateUrl:"/public/tpls/mobile/page/page-history.html",controller:"HistoryCtrl"}}}).state("tab.result-history",{url:"/result/history-{pid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-result":{templateUrl:"/public/tpls/mobile/page/page-history.html",controller:"HistoryCtrl"}}}).state("tab.show-history",{url:"/show/history-{pid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-show":{templateUrl:"/public/tpls/mobile/page/page-history.html",controller:"HistoryCtrl"}}}).state("tab.profile-history",{url:"/profile/history-{pid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/page/page-history.html",controller:"HistoryCtrl"}}}).state("tab.index-yungou",{url:"/index/yungou-{yid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-index":{templateUrl:"/public/tpls/mobile/page/page-yungou.html",controller:"YungouCtrl"}}}).state("tab.result-yungou",{url:"/result/yungou-{yid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-result":{templateUrl:"/public/tpls/mobile/page/page-yungou.html",controller:"YungouCtrl"}}}).state("tab.show-yungou",{url:"/show/yungou-{yid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-show":{templateUrl:"/public/tpls/mobile/page/page-yungou.html",controller:"YungouCtrl"}}}).state("tab.profile-yungou",{url:"/profile/yungou-{yid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/page/page-yungou.html",controller:"YungouCtrl"}}}).state("tab.index-show",{url:"/index/show-{sid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-index":{templateUrl:"/public/tpls/mobile/page/page-show.html",controller:"ShowDetailCtrl"}}}).state("tab.result-show",{url:"/result/show-{sid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-result":{templateUrl:"/public/tpls/mobile/page/page-show.html",controller:"ShowDetailCtrl"}}}).state("tab.show-show",{url:"/show/show-{sid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-show":{templateUrl:"/public/tpls/mobile/page/page-show.html",controller:"ShowDetailCtrl"}}}).state("tab.profile-show",{url:"/profile/show-{sid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/page/page-show.html",controller:"ShowDetailCtrl"}}}).state("tab.index-calcuate",{url:"/index/calcuate-{sid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-index":{templateUrl:"/public/tpls/mobile/page/page-calcuate.html",controller:"CalcuateCtrl"}}}).state("tab.result-calcuate",{url:"/result/calcuate-{sid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-result":{templateUrl:"/public/tpls/mobile/page/page-calcuate.html",controller:"CalcuateCtrl"}}}).state("tab.show-calcuate",{url:"/show/calcuate-{sid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-show":{templateUrl:"/public/tpls/mobile/page/page-calcuate.html",controller:"CalcuateCtrl"}}}).state("tab.profile-calcuate",{url:"/profile/calcuate-{sid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/page/page-calcuate.html",controller:"CalcuateCtrl"}}}).state("tab.payment",{url:"/cart/payment-{cashierid:[0-9]+}",views:{"tab-cart":{templateUrl:"/public/tpls/mobile/page/page-payment.html",controller:"PaymentCtrl"}}}).state("tab.payresult",{url:"/cart/payresult-{cashierid:[0-9]+}-{fee:[0-9]+}-{isCancel:[0-1]{1}}",views:{"tab-cart":{templateUrl:"/public/tpls/mobile/page/page-payresult.html",controller:"PayresultCtrl"}}}).state("tab.payresult-yungou",{url:"/cart/yungou-{yid:[0-9]{1,10}}-{time:[0-9]{1,20}}",views:{"tab-cart":{templateUrl:"/public/tpls/mobile/page/page-yungou.html",controller:"YungouCtrl"}}}).state("tab.rechargeResult",{url:"/profile/rechargeResult-{tradeId:[0-9]+}-{fee:[0-9]+}-{isCancel:[0-1]{1}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/page/page-rechargeResult.html",controller:"RechargeResultCtrl"}}}).state("tab.profile-setting",{url:"/profile/setting",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-setting.html",controller:"ProfileSettingCtrl"}}}).state("tab.profile-userRecord",{url:"/profile/userRecord-{uid:[0-9]{1,10}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/page/page-userRecord.html",controller:"UserRecordCtrl"}}}).state("tab.profile-editPsd",{url:"/profile/editPsd",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-editPsd.html",controller:"ProfileCtrl"}}}).state("tab.profile-recharge",{url:"/profile/recharge",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-recharge.html",controller:"RechargeCtrl"}}}).state("tab.profile-credit",{url:"/profile/credit",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-credit.html",controller:"CreditCtrl"}}}).state("tab.profile-credit-record",{url:"/profile/creditRecord",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-credit-record.html",controller:"CreditRecordCtrl"}}}).state("tab.profile-balance",{url:"/profile/balance",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-balance.html",controller:"BalanceCtrl"}}}).state("tab.profile-recordBuy",{url:"/profile/recordBuy",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-recordBuy.html",controller:"recordBuyCtrl"}}}).state("tab.profile-recordWin",{url:"/profile/recordWin",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-recordWin.html",controller:"recordWinCtrl"}}}).state("tab.profile-expose",{url:"/profile/expose",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-expose.html",controller:"exposeCtrl"}}}).state("tab.profile-expose-add",{url:"/profile/expose/add-{yid:[0-9]{1,10}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-expose-add.html",controller:"exposeAddCtrl"}}}).state("tab.profile-expose-success",{url:"/profile/expose/success-{yid:[0-9]{1,10}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-expose-success.html",controller:"exposeSuccessCtrl"}}}).state("tab.profile-address",{url:"/profile/address",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-address.html",controller:"AddressCtrl"}}}).state("tab.profile-addressEdit",{url:"/profile/addressEdit-{addressId:[0-9]{1,10}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-addressEdit.html",controller:"AddressEditCtrl"}}}).state("tab.profile-winDetail",{url:"/profile/winDetail-{winOrderId:[0-9]{1,10}}",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-winDetail.html",controller:"winDetailCtrl"}}}).state("tab.profile-agency",{url:"/profile/agency",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-agency.html",controller:"AgencyCtrl"}}}).state("tab.profile-suggest",{url:"/profile/suggest",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-suggest.html",controller:"SuggestCtrl"}}}).state("tab.profile-help",{url:"/profile/help",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-help.html",controller:"HelpCtrl"}}}).state("tab.profile-winDetail-address",{url:"/profile/winDetail-{winOrderId:[0-9]{1,10}}/address",views:{"tab-profile":{templateUrl:"/public/tpls/mobile/profile/profile-address.html",controller:"addressCtrl"}}}).state("tab.result-userRecord",{url:"/result/userRecord-{uid:[0-9]{1,10}}",views:{"tab-result":{templateUrl:"/public/tpls/mobile/page/page-userRecord.html",controller:"UserRecordCtrl"}}}).state("tab.index-userRecord",{url:"/index/userRecord-{uid:[0-9]{1,10}}",views:{"tab-index":{templateUrl:"/public/tpls/mobile/page/page-userRecord.html",controller:"UserRecordCtrl"}}}),o.otherwise("/tab/index")}]),angular.module("YYYG.filters",[]).filter("range",[function(){return function(e,t){t=parseInt(t);for(var o=0;t>o;o++)e.push(o);return e}}]).filter("dateTransfer",[function(){return function(e){var t=parseInt(e/60),o=e%60;return t+"分"+o+"秒"}}]).filter("minute",[function(){return function(e){if("undefined"==typeof e||!e||0>=e)return"00";var t=parseInt(e/6e4);return 10>t?"0"+t:t}}]).filter("second",[function(){return function(e){if("undefined"==typeof e||!e||0>=e)return"00";var t=parseInt(e/1e3)%60;return 10>t?"0"+t:t}}]).filter("microsecond",[function(){return function(e){if("undefined"==typeof e||!e||0>=e)return"00";var t=parseInt(e/10)%100;return 10>t?"0"+t:t}}]),angular.module("YYYG").factory("Service",["$http",function(e){var t={};return t.checkLogin=function(o){void 0!=t.isLogin?o():e.get("/user/isLogin").success(function(e){200===e.code?(t.isLogin=!0,t.user=e.data[0]):t.isLogin=!1}).error(function(e){t.isLogin=!1})["finally"](function(){o()})},t}]),angular.module("YYYG").factory("UserService",["$http","$interval",function(e,t){var o={};return o.checkSignIn=function(t){"undefined"!=typeof o.isSignIn?t():e.get("/credit/isSignIn").success(function(e){200===e.code?o.isSignIn=!0:o.isSignIn=!1})["finally"](function(){t()})},o.signIn=function(t){var r=0;o.isSignIn?t(r):e.get("/credit/signIn").success(function(e){200==e.code&&(o.isSignIn=!0,r=10)}).error(function(e){console.log(e)})["finally"](function(){t(r)})},o.rechargeReady=function(o,r){var n=null;n=t(function(){e.get("/balance/getByTradeId?tradeId="+r).success(function(e){200==e.code&&(t.cancel(n),o())}).error(function(e){console.log(e)})},2e3)},o.getBalance=function(t,o,r){e.get("/balance/getBalanceByUser?limit="+o+"&page="+r).success(function(e){200==e.code&&t.call(null,e.data)}).error(function(e){console.log(e)})},o.getCredit=function(t,o,r){e.get("/credit/getRecord?limit="+o+"&page="+r).success(function(e){200==e.code&&t.call(null,e.data)}).error(function(e){console.log(e)})},o.wx=function(t){var o=function(){};2==arguments.length&&(o=[].pop.call(arguments)),e.get("/wx/getJsApiConfig?url="+encodeURIComponent(location.href.split("#")[0])).success(function(e){200==e.code&&(wx.config({debug:!1,appId:e.data.appId,timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}),wx.checkJsApi({jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"],success:function(e){}}),wx.ready(function(){wx.onMenuShareTimeline({title:t.userName+"分享了1元红包，你也可以领取参与收获惊喜！",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx5978bb99a4b31667&redirect_uri=http%3a%2f%2ftest.dangke.co%2fwx%2foauthwithcode&response_type=code&scope=snsapi_base&state="+t.code+"#wechat_redirect",imgUrl:"http://7xs9hx.com1.z0.glb.clouddn.com/champion.jpg",success:function(){o()},cancel:function(){}}),wx.onMenuShareAppMessage({title:t.userName+"送你1元红包，领取夺宝惊喜无限！",desc:'只需花一元就有机会获得梦想奖品，勇夺武林萌主，尽享"逆袭"激情！',link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx5978bb99a4b31667&redirect_uri=http%3a%2f%2ftest.dangke.co%2fwx%2foauthwithcode&response_type=code&scope=snsapi_base&state="+t.code+"#wechat_redirect",imgUrl:"http://7xs9hx.com1.z0.glb.clouddn.com/champion.jpg",type:"link",dataUrl:"",success:function(){o()},cancel:function(){}})}))}).error(function(e){console.log(e)})},o.getHbRecords=function(t){e.get("/user/getHbRecords").success(function(e){console.log(e),200==e.code&&t.call(null,e.data)}).error(function(e){console.log(e)})},o}]),angular.module("YYYG").factory("ShowService",[function(){}]),angular.module("YYYG").factory("AddressService",["$http",function(e){var t={};return t.addresses=[],t.getAll=function(o){t.addresses.length>0?o():e.get("/address/getAll").success(function(e){200===e.code&&(t.addresses=e.data)})["finally"](function(){o()})},t.provinces=[],t.getProvinces=function(o){t.provinces.length>0?o():e.get("/address/province").success(function(e){200===e.code&&(t.provinces=e.data)})["finally"](function(){o()})},t.getCities=function(o,r){t.cities=[],e.get("/address/city?provinceId="+o).success(function(e){200===e.code&&(t.cities=e.data)})["finally"](function(){r()})},t.getAreas=function(o,r){t.areas=[],e.get("/address/area?cityId="+o).success(function(e){200===e.code&&(t.areas=e.data)})["finally"](function(){r()})},t.addAddress=function(o,r){e.post("/address/addMobile",o,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e){if(200===e.code){if(1==e.data.status)for(var o=0;o<t.addresses.length;o++)t.addresses[o].status=0;t.addresses.push(e.data),r(!0)}else r(!1,e.code)}).error(function(e){r(!1,404)})},t.updateAddress=function(o,r){var n={id:o.id,provinceID:o.provinceID,cityID:o.cityID,areaID:o.areaID,idCode:o.idCode,phoneNumber:o.phoneNumber,postCode:o.postCode,receiver:o.receiver,status:o.status,street:o.street};e.post("/address/update",{address:n},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e){200===e.code?(angular.forEach(t.addresses,function(o,r){o.id==e.data.id?t.addresses[r]=e.data:1==e.data.status&&(t.addresses[r].status=0)}),r(!0)):r(!1)}).error(function(e){r(!1)})},t.deleteAddress=function(o,r){for(var n=-1,i=0;i<t.addresses.length;i++)if(t.addresses[i].id==o){n=i;break}-1==n?r(!0):e.post("/address/remove",{id:o},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e){200===e.code?(t.addresses.splice(n,1),r(!0)):r(!1)}).error(function(e){r(!1)})},t}]),angular.module("YYYG").factory("YungouService",["$http","$interval",function(e,t){var o={};return o.countDown=function(e,o){var r=function(t,o){for(var r=0;r<t.length;r++)o.call(e,r)},n=null;return function(){var i=[],a=new Date,s=0;n&&(t.cancel(n),n=null),n=t(function(){var c=new Date;s=c-a>20?parseInt(c-a-20):0,a=c,r(e,function(r){this[r]<=0?(this[r]=0,-1==i.indexOf(r)&&(i.push(r),i.length==e.length&&t.cancel(n),o(r))):this[r]-20<0?this[r]=0:this[r]-=20+s})},20)}},o.getLatestYungou=function(t,o){e.get("/yungou/getLatestYungou?yid="+o).success(function(e){200==e.code&&t.call(null,e.data.id)}).error(function(e){console.log(e)})},o.toLatestYungou=function(t,o){e.get("/yungou/getLatestByProduct?pid="+o).success(function(e){200==e.code&&t.call(null,e.data.id)}).error(function(e){console.log(e)})},o.getCompute=function(t,o){e.get("/yungou/compute?id="+o).success(function(e){200==e.code&&t.call(null,e.data)}).error(function(e){console.log(e)})},o.getResult=function(t,o){e.get("/yungou/getResult?id="+o).success(function(e){200===e.code&&t.call(null,e.data[0])}).error(function(e){console.log(e)})},o}]),angular.module("YYYG").controller("TabCtrl",["$scope","$rootScope","$http","$interval","$timeout","$ionicModal","$ionicLoading","YungouService",function(e,t,o,r,n,i,a,s){function c(){o.get("/user/isLogin").success(function(r){200===r.code&&(t.user=r.data[0],1==t.user.showHb&&""!=t.user.invitedBy&&($("ion-side-menu-content").append(e.newSign),$(e.newSign).css("display","block"),o.get("/user/notShowHb").success(function(e){200==e.code&&(t.user.showHb=0)}).error(function(e){console.log(e)})),t.getCart())})}t.setCartCount=function(){t.cartCount.textContent=t.shoppingCarts.length,t.cartDetailCount.textContent=t.shoppingCarts.length,0==t.shoppingCarts.length?($(t.cartCount).css({display:"none"}),$(t.cartDetailCount).css({display:"none"})):($(t.cartCount).css({display:"block"}),$(t.cartDetailCount).css({display:"block"}))},e.newSign=document.createElement("div"),e.className="new-sign",e.id="newSign",t.is_weixin=function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?!0:!1}(),t.shoppingCarts=$.parseJSON(window.localStorage.getItem("localCarts"))||[],t.cartDetailCount=document.createElement("b"),t.cartCount=document.createElement("b"),$(t.cartCount).css({position:"absolute",top:"2px",fontSize:"12px",lineHeight:"8px",color:"#fff",left:"71%",background:"#DF3051",borderRadius:"50%",zIndex:"9999",padding:"5px"}),t.setCartCount(),$(document).ready(function(){$(document.getElementsByTagName("ion-tabs")[0].firstChild).append(t.cartCount)}),t.mergeShoppingCart=function(){var e=$.parseJSON(window.localStorage.getItem("localCarts"));if(e){for(var o=0;o<e.length;o++)t.addToCart(e[o]);window.localStorage.removeItem("localCarts")}t.setCartCount()},t.getCart=function(){o.get("/shoppingCart/intoCart").success(function(e){200===e.code&&(t.shoppingCarts=e.data),t.mergeShoppingCart()}).error(function(e){console.log(e)})},t.addToCart=function(e,r){if("undefined"==typeof e.amount){var n={};n.amount=e.product.singlePrice,n.price=e.product.price,n.productId=e.product.id,n.saleCount=e.yungou.saleCount,n.singlePrice=e.product.singlePrice,n.term=e.yungou.term,n.thumbnailUrl=e.product.thumbnailUrl,n.title=e.product.title,n.yungouId=e.yungou.id,e=n}if(t.user)o.post("/shoppingCart/add",{yungouId:e.yungouId,amount:e.amount},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(o,r,n,i){if(200==o.code){for(var a=!0,s=0;s<t.shoppingCarts.length;s++)if(t.shoppingCarts[s].yungouId==e.yungouId){a=!1,parseInt(t.shoppingCarts[s].amount)+parseInt(e.amount)>t.shoppingCarts[s].price?t.shoppingCarts[s].amount=t.shoppingCarts[s].price:t.shoppingCarts[s].amount=parseInt(t.shoppingCarts[s].amount)+parseInt(e.amount);break}a&&t.shoppingCarts.push(e)}t.setCartCount()}).error(function(e){});else{for(var i=!0,n=0;n<t.shoppingCarts.length;n++)if(t.shoppingCarts[n].yungouId==e.yungouId){i=!1,parseInt(t.shoppingCarts[n].amount)+parseInt(e.amount)>t.shoppingCarts[n].price?t.shoppingCarts[n].amount=t.shoppingCarts[n].price:t.shoppingCarts[n].amount=parseInt(t.shoppingCarts[n].amount)+parseInt(e.amount);break}i&&t.shoppingCarts.push(e),window.localStorage.setItem("localCarts",JSON.stringify(t.shoppingCarts)),t.setCartCount()}return!1},t.toCartCartoon=function(e,t,o){var r,n,i,a,s,c,l;if(/android|webos|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())?o?(c=document.getElementById(t),l=c.scrollTop):(c=document.getElementById(t),l=c.scrollTop):o?(c=document.getElementById(t).firstChild,l=0-parseInt($(c).css("transform").split(",")[5].split(")")[0])):(c=document.getElementById(t).firstChild,l=0-parseInt($(c).css("transform").split(",")[5].split(")")[0])),o){var d=document.getElementById(e);r=d.offsetLeft,n=d.offsetTop;var u=d.parentNode.parentNode.parentNode.parentNode;for(n-=l,c=d.offsetParent;null!==c;)n+=c.offsetTop,r+=c.offsetLeft,c=c.offsetParent;s=$("<img src='"+d.src+"' width="+d.offsetWidth+" height="+d.offsetHeight+" style='display:block;position:absolute;left:"+r+"px;top:"+n+"px;'>"),i=.7*u.offsetWidth+parseInt($(u).css("margin-left").replace("px","")),a=document.documentElement.clientHeight-20}else r=.5*document.documentElement.clientWidth-100,n=44,n-=l,s=$("<img src='"+e+"' width=200 height=200 style='display:block;position:absolute;left:"+r+"px;top:"+n+"px;'>"),i=document.documentElement.clientWidth-15,a=20;$(document.body).append(s),s.css("zIndex",9999).animate({position:"absolute",width:0,height:0,left:i+"px",top:a+"px",display:"block","z-Index":9999},700,function(){s.remove()})},c(),r(c,1e4),t.checkLoginAndModal=function(e){t.user||(t.is_weixin?window.location.href="http://"+window.location.host+"/wx/login?returnAddress=/tab/"+t.activedTab:t.loginModal.show(),e&&e.preventDefault())},t.loginUser={},e.logining=!1,e.loginBtnText="登录",i.fromTemplateUrl("/public/tpls/mobile/modal/modal-login.html",{scope:e}).then(function(e){t.loginModal=e}),e.login=function(){e.logining=!0,e.loginBtnText="登录中..",o.post("/user/login",{phoneNumber:t.loginUser.phone,password:t.loginUser.password},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e){200===e.code?(t.user=e.data[0],window.location.hash.split("/").length<=3?window.location.reload():(window.location.hash="#/tab/index",window.location.reload())):405===e.code&&alert("手机或密码错误")}).error(function(e){console.error(e)})["finally"](function(){e.logining=!1,e.loginBtnText="登录"})},t.registerUser={},e.registering=!1,e.codeBtnText="发送验证码",e.countDown=60,e.codeBtnDisabled=!1,e.registerBtnTxt="立即注册",e.timer=void 0,i.fromTemplateUrl("/public/tpls/mobile/modal/modal-register.html",{scope:e}).then(function(e){t.registerModal=e}),e.sendCode=function(){o.get("/user/isUserExit?phoneNumber="+t.registerUser.phone).success(function(n){404==n.code?(e.codeBtnDisabled=!0,o.get("/user/sendVerificationCode?phoneNumber="+t.registerUser.phone).success(function(t){200===t.code?e.timer=r(function(){return e.countDown<=0?(e.codeBtnDisabled=!1,e.codeBtnText="发送验证码",r.cancel(e.timer),e.timer=null,void(e.countDown=60)):void(e.codeBtnText=--e.countDown+"秒重发..")},1e3):(e.codeBtnText="获取验证码",alert("发送短信太过频繁！"))})):alert("该手机号已被注册！")}).error(function(e){console.error(e)})},e.register=function(){e.registering=!0,e.registerBtnTxt="注册中...",o.post("/user/register",{phoneNumber:t.registerUser.phone,password:t.registerUser.password,code:t.registerUser.code,invitedCode:t.registerUser.invitedCode},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(t){200===t.code?(e.registering=!1,e.codeBtnText="发送验证码",e.countDown=60,e.codeBtnDisabled=!1,e.registerBtnTxt="立即注册",e.timer&&(r.cancel(e.timer),e.timer=null),window.location.hash.split("/").length<=3?window.location.reload():(window.location.hash="#/tab/index",window.location.reload())):405===t.code&&(e.registering=!1,e.registerBtnTxt="立即注册",alert("验证码不正确"))})},t.timeStamp=(new Date).getTime(),r(function(){t.timeStamp=(new Date).getTime()},1e3),t.activedTab=window.location.hash.split("/")[2],t.activedTab=window.location.hash.split("/")[2],window.location.hash.split("/").length<=3?t.hideTabs="":t.hideTabs="tabs-item-hide",angular.element(window).on("hashchange",function(){t.activedTab=window.location.hash.split("/")[2],window.location.hash.split("/").length<=3?t.hideTabs="":t.hideTabs="tabs-item-hide"}),i.fromTemplateUrl("/public/tpls/mobile/page/page-yungou-content.html",{scope:e}).then(function(e){t.contentModal=e}),e.newSign.addEventListener("click",function(){$(e.newSign).css({display:"none"});var t="profile";location.href.slice(0-t.length)!=t?location.hash="#/tab/profile?location=balance":location.hash="#/tab/profile/balance"}),t.toLatestYungou=function(e,o){""!=e&&(s.toLatestYungou(function(e){location.hash="#tab/"+t.activedTab+"/yungou-"+e+"-"+t.timeStamp},e),o.preventDefault())}}]).controller("SideMenuCtrl",["$scope","$rootScope","$http","$ionicSideMenuDelegate","$ionicLoading",function(e,t,o,r,n){t.toggleLeftSideMenu=function(){r.toggleLeft()},t.showLoading=function(e){n.show({template:e})},t.hideLoading=function(){n.hide()},t.categories=[],o.get("/category/getAll").success(function(e){200===e.code&&(t.categories=e.data)}).error(function(e){console.log(e)}),t.yungous=[],t.index_title="全部商品",t.selectCategory=function(e,r,n){t.index_title=r,n&&t.toggleLeftSideMenu(),t.current_category!==e&&(t.yungous=[],t.current_category=e,t.current_sort=0,0===e?(t.showLoading("加载中.."),o.get("/yungou/getAll").success(function(e){200===e.code&&(t.yungous=e.data,t.sort())})["finally"](function(){t.hideLoading()})):(t.showLoading("加载中.."),o.get("/yungou/getCategory?id="+e).success(function(e){200===e.code&&(t.yungous=e.data)})["finally"](function(){t.hideLoading()})))},t.sort=function(){t.yungous=t.yungous.sort(function(e,o){switch(t.current_sort){case 0:return o.product.priority==e.product.priority?Date.parse(o.yungou.createdTime)-Date.parse(e.yungou.createdTime)||t.yungous.indexOf(o)-t.yungous.indexOf(e):parseInt(o.product.priority)-parseInt(e.product.priority)||t.yungous.indexOf(o)-t.yungous.indexOf(e);break;case 1:return o.yungou.term==e.yungou.term?Date.parse(o.yungou.createdTime)-Date.parse(e.yungou.createdTime)||t.yungous.indexOf(o)-t.yungous.indexOf(e):o.yungou.term-e.yungou.term||t.yungous.indexOf(o)-t.yungous.indexOf(e);break;case 2:return e.product.price-e.yungou.saleCount-(o.product.price-o.yungou.saleCount)||t.yungous.indexOf(e)-t.yungous.indexOf(o);break;case 3:if(t.isUp)return e.product.price-o.product.price||t.yungous.indexOf(e)-t.yungous.indexOf(o);if(t.isDown)return o.product.price-e.product.price||t.yungous.indexOf(o)-t.yungous.indexOf(e)}})},t.selectCategory(0,t.index_title,!1)}]),angular.module("YYYG").controller("IndexCtrl",["$scope","$rootScope","$http","$ionicSlideBoxDelegate",function(e,t,o,r){o.get("/banner/getAll").success(function(e){200===e.code&&(t.banners=e.data,r.update())}).error(function(e){console.error(e)}),e.doRefresh=function(){0===t.current_category?o.get("/yungou/getAll").success(function(e){200===e.code&&(t.yungous=e.data,3==t.current_sort&&(t.isUp=!t.isUp,t.isDown=!t.isDown),t.selectSort(t.current_sort))})["finally"](function(){e.$broadcast("scroll.refreshComplete")}):o.get("/yungou/getCategory?id="+t.current_category).success(function(e){200===e.code&&(t.yungous=e.data,3==t.current_sort&&(t.isUp=!t.isUp,t.isDown=!t.isDown),t.selectSort(t.current_sort))})["finally"](function(){e.$broadcast("scroll.refreshComplete")})},t.current_sort=0,t.isUp=!1,t.isDown=!1,t.selectSort=function(e){t.current_sort!==e&&(t.current_sort=e,t.sort(),t.isUp=!1,t.isDown=!1),3==e&&(t.isUp?(t.isUp=!1,t.isDown=!0):(t.isUp=!0,t.isDown=!1),t.sort())}}]).controller("YungouCtrl",["$scope","$rootScope","$http","$stateParams","$ionicHistory","$ionicSlideBoxDelegate","$interval","$ionicModal","YungouService",function(e,t,o,r,n,i,a,s,c){t.cartDetailCount.textContent=t.shoppingCarts.length,$(t.cartDetailCount).css({position:"absolute",top:"2px",fontSize:"12px",lineHeight:"8px",color:"#fff",right:"8px",background:"#DF3051",borderRadius:"50%",zIndex:"9999",padding:"5px"}),$("ion-view.yungou-page").append(t.cartDetailCount),e.yid=r.yid,e.orderPerTime=5,e.hasMoreData=!0,e.myOrders=[],e.timeoutArr=[],e.numbersArr=[],e.toLatestYungou=function(){c.getLatestYungou(function(e){location.hash="#tab/"+t.activedTab+"/yungou-"+e+"-"+t.timeStamp},e.yid)},c.getLatestYungou(function(t){e.lastId=t},e.yid),e.toIndex=function(){location.hash="#/tab/index",location.reload()},t.showLoading("加载中.."),e.start=function(){c.countDown(e.timeoutArr,function(t){e.yungou.status=2,e.timer=a(function(){o.get("/yungou/getWin?id="+e.yungou.id).success(function(t){e.winner=t.data,a.cancel(e.timer)}).error(function(e){console.error(e)})},1e3)})()},e.getYungou=function(){o.get("/yungou/getByYungou?yid="+e.yid).success(function(r){200===r.code?(e.product=r.data.product,e.yungou=r.data.yungou,i.update(),t.hideLoading(),2==e.yungou.status?o.get("/yungou/getWin?id="+e.yungou.id).success(function(t){e.winner=t.data}).error(function(e){console.error(e)}):1==e.yungou.status&&(e.start(),e.timeoutArr.push(1e3*e.yungou.timeout)),e.showContent=function(){t.content=e.product.content,t.contentModal.show()}):(n.goBack(),t.hideLoading())}).error(function(e){console.error(e)})},e.showNumbers=function(t,o,r){e.createModal(function(){e.result=r,e.title=t,e.term=o,e.numbers=e.numbersArr,e.numberModal.show()})},e.createModal=function(t){s.fromTemplateUrl("/public/tpls/mobile/modal/modal-record-number.html",{scope:e}).then(function(o){e.numberModal=o,t()})},e.showWinnerNumber=function(t,r,n,i){e.createModal(function(){o.get("/order/getNumbers?id="+e.yid+"&userId="+n).success(function(o){if(200==o.code){var n=o.data.numbers,a=[];e.result=i,e.title=t,e.term=r,n.forEach(function(e){for(var t=e.numberStart,o=e.numberEnd;o>=t;t++)a.push(t)}),e.numbers=a,e.numberModal.show()}}).error(function(e){console.log(e)})["finally"](function(){})})},e.getYungou(),o.get("/user/isLogin").success(function(t){200===t.code&&o.get("/order/getNumbers?id="+e.yid+"&userId="+t.data[0].id).success(function(t){e.count=t.data.count,200===t.code&&t.data.count>0&&t.data.numbers.forEach(function(t){for(var o=t.numberStart,r=t.numberEnd;r>=o;o++)e.numbersArr.push(o)})}).error(function(e){console.error(e)})}),o.get("/order/orderByYungouMobile?yid="+e.yid+"&limit="+e.orderPerTime).success(function(t){200===t.code&&t.data.length>0?(e.orders=t.data,t.data.length<e.orderPerTime&&(e.hasMoreData=!1)):e.hasMoreData=!1}).error(function(e){console.error(e)}),e.loadMore=function(){return console.log("loadMore"),e.hasMoreData?0===e.orders.length?void e.$broadcast("scroll.infiniteScrollComplete"):void o.get("/order/orderByYungouMobile?yid="+e.yid+"&limit="+e.orderPerTime+"&buyTime="+e.orders[e.orders.length-1].buyTime).success(function(t){200===t.code&&t.data.length>0?(t.data.forEach(function(t){e.orders.push(t)}),t.data.length<e.orderPerTime&&(e.hasMoreData=!1)):e.hasMoreData=!1,e.$broadcast("scroll.infiniteScrollComplete")}):void e.$broadcast("scroll.infiniteScrollComplete")}}]).controller("CalcuateCtrl",["$scope","$stateParams","YungouService",function(e,t,o){e.yungouId=t.sid,e.init=!1,e.records=[],o.getResult(function(t){e.A=t.A,e.B=t.B,e.result=t.result,e.sscTerm=t.sscTerm,e.init=!0},e.yungouId),o.getCompute(function(t){e.records=t},e.yungouId),e.popOut=!1,e.toggle=function(){e.popOut=!e.popOut}}]).controller("HistoryCtrl",["$scope","$stateParams","$rootScope","$http",function(e,t,o,r){e.pid=t.pid,e.records=[],e.hasMoreData=!0,o.showLoading("加载中.."),r.get("/yungou/getHistoryMobile?limit=10&productId="+e.pid).success(function(t){200==t.code&&(e.records=e.records.concat(t.data),e.records.length>0&&(e.startTime=e.records[e.records.length-1].startTime))}).error(function(e){console.log(e)})["finally"](function(){o.hideLoading()}),e.doRefresh=function(){r.get("/yungou/getHistoryMobile?limit=10&productId="+e.pid).success(function(t){200==t.code&&(e.records=t.data)}).error(function(e){console.log(e)})["finally"](function(){e.$broadcast("scroll.refreshComplete")})},e.loadMore=function(){r.get("/yungou/getHistoryMobile?limit=10&productId="+e.pid+"&startTime="+e.startTime).success(function(t){200==t.code&&(t.data.length<10&&(e.hasMoreData=!1),e.records=e.records.concat(t.data),e.records.length>0&&(e.startTime=e.records[e.records.length-1].startTime))}).error(function(e){console.log(e)})["finally"](function(){e.$broadcast("scroll.infiniteScrollComplete")})}}]),angular.module("YYYG").controller("ResultCtrl",["$scope","$rootScope","$http","$interval","YungouService",function(e,t,o,r,n){
e.hasMoreData=!0,e.isRefresh=!1,e.isLoad=!1,e.remainRecords=[],e.finishRecords=[],e.timeoutArr=[],e.init=!1,e.start=function(){n.countDown(e.timeoutArr,function(t){e.timer=r(function(){o.get("/order/winOrder?yungouId="+e.remainRecords[t].yungouId).success(function(o){200==o.code&&1==o.data.length&&(e.remainRecords[t].winUser=o.data[0],r.cancel(e.timer))}).error(function(e){console.log(e)})},1e3)})()},e.getResult=function(){var r="/yungou/fastStart?limit=10";"undefined"!=typeof e.startTime?r+="&startTime="+e.startTime:e.init||t.showLoading("加载中.."),o.get(r).success(function(t){if(200==t.code){e.isRefresh&&(e.remainRecords=[],e.finishRecords=[],e.timeoutArr=[],e.start()),t=t.data;for(var o=0;o<t.length;o++)1==t[o].status?(e.remainRecords.push(t[o]),e.timeoutArr.push(1e3*t[o].timeout)):e.finishRecords.push(t[o]);t.length>0&&(e.startTime=t[t.length-1].startTime),t.length<10?e.hasMoreData=!1:e.hasMoreData=!0}}).error(function(e){console.log(e)})["finally"](function(){t.hideLoading(),e.isRefresh&&(e.isRefresh=!1,e.$broadcast("scroll.refreshComplete")),e.isLoad&&(e.isLoad=!1,e.$broadcast("scroll.infiniteScrollComplete")),e.init=!0})},e.start(),e.getResult(),e.doRefresh=function(){e.startTime=void 0,e.hasMoreData=!0,e.isRefresh=!0,e.getResult()},e.loadMoreData=function(){e.isLoad=!0,e.getResult()}}]),angular.module("YYYG").controller("ShowCtrl",["$scope","$rootScope","$http","$stateParams",function(e,t,o,r){e.pid=r.pid,e.lastID=0,e.shareInfos=[],e.init=!1,e.perAmount=5,e.hasMoreData=!0,t.showLoading("加载中.."),"undefined"==typeof e.pid?e.url="/show/getAll?":e.url="/show/getByProduct?productId="+e.pid+"&",o.get(e.url+"limit="+e.perAmount).success(function(t){200===t.code&&t.data.length>0?(e.shareInfos=t.data,e.firstID=e.shareInfos[0].showId,e.lastID=e.shareInfos[e.shareInfos.length-1].showId,t.data.length<e.perAmount&&(e.hasMoreData=!1)):e.hasMoreData=!1}).error(function(e){console.error(e)})["finally"](function(){t.hideLoading(),e.init=!0}),e.doRefresh=function(){o.get(e.url+"firstId="+e.firstID+"&limit="+e.perAmount).success(function(t){200===t.code&&(t.data.length<e.perAmount&&(e.hasMoreData=!1),t.data.forEach(function(t){e.shareInfos.unshift(t)}),e.firstID=e.shareInfos[0].showId)})["finally"](function(){e.$broadcast("scroll.refreshComplete")})},e.loadMore=function(){return e.hasMoreData?0===e.lastID?void e.$broadcast("scroll.infiniteScrollComplete"):void o.get(e.url+"lastId="+e.lastID+"&limit="+e.perAmount).success(function(t){200===t.code&&t.data.length>0?(t.data.forEach(function(t){e.shareInfos.push(t),e.lastID=e.shareInfos[e.shareInfos.length-1].showId}),t.data.length<e.perAmount&&(e.hasMoreData=!1),e.$broadcast("scroll.infiniteScrollComplete")):e.hasMoreData=!1}):void e.$broadcast("scroll.infiniteScrollComplete")}}]).controller("ShowDetailCtrl",["$scope","$rootScope","$http","$stateParams","$ionicHistory",function(e,t,o,r,n){e.sid=r.sid,o.get("/show/getDetail?showId="+e.sid).success(function(t){200===t.code?(e.showInfo=t.data,console.log(e.showInfo)):n.goBack()}).error(function(e){console.error(e)})}]),angular.module("YYYG").controller("CartCtrl",["$scope","$rootScope","$http",function(e,t,o){e.deleteOneItem=function(e){confirm("确定要删除该商品吗?")&&(t.user?o.post("/shoppingCart/remove",{id:t.shoppingCarts[e].shoppingCartId},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(o){200===o.data.code&&t.shoppingCarts.splice(e,1),t.setCartCount()},function(e){console.log(e)}):(t.shoppingCarts.splice(e,1),t.shoppingCarts.length>0?window.localStorage.setItem("localCarts",JSON.stringify(t.shoppingCarts)):window.localStorage.removeItem("localCarts"),t.setCartCount()))},e.doRefresh=function(){o.get("/shoppingCart/intoCart").success(function(e){200===e.code&&(t.shoppingCarts=e.data,t.setCartCount())}).error(function(e){console.log(e)})["finally"](function(){e.$broadcast("scroll.refreshComplete")})},e.addOne=function(e){t.shoppingCarts[e].amount!=parseInt(t.shoppingCarts[e].price-t.shoppingCarts[e].saleCount)&&(t.shoppingCarts[e].amount=parseInt(t.shoppingCarts[e].amount)+parseInt(t.shoppingCarts[e].singlePrice))},e.minusOne=function(e){t.shoppingCarts[e].amount>t.shoppingCarts[e].singlePrice&&(t.shoppingCarts[e].amount-=t.shoppingCarts[e].singlePrice)},e.checkInputValue=function(e){isNaN(t.shoppingCarts[e].amount)||t.shoppingCarts[e].amount<t.shoppingCarts[e].singlePrice?t.shoppingCarts[e].amount=t.shoppingCarts[e].singlePrice:t.shoppingCarts[e].amount>parseInt(t.shoppingCarts[e].price-t.shoppingCarts[e].saleCount)?t.shoppingCarts[e].amount=t.shoppingCarts[e].price-t.shoppingCarts[e].saleCount:t.shoppingCarts[e].amount%t.shoppingCarts[e].singlePrice!==0?t.shoppingCarts[e].amount-=t.shoppingCarts[e].amount%t.shoppingCarts[e].singlePrice:t.shoppingCarts[e].amount=Math.floor(t.shoppingCarts[e].amount)},e.getTotal=function(){for(var e=0,o=0;o<t.shoppingCarts.length;o++)e+=parseInt(t.shoppingCarts[o].amount);return e},e.getAmount=function(){return t.shoppingCarts.length},e.addCashier=function(){if(t.user){t.showLoading("结算中..");for(var e=[],r=0,n=t.shoppingCarts.length;n>r;r++)e.push({productId:t.shoppingCarts[r].productId,yungouId:t.shoppingCarts[r].yungouId,count:t.shoppingCarts[r].amount});o.post("/cashier/add",{orders:e},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e,o,r,n){200==e.code&&(t.shoppingCarts=[],t.setCartCount(),location.hash="#tab/cart/payment-"+e.data)}).error(function(e){console.log(e)})["finally"](function(){t.hideLoading()})}else t.checkLoginAndModal()}}]).controller("PaymentCtrl",["$scope","$rootScope","$http","$stateParams","$interval","$ionicHistory",function(e,t,o,r,n,i){t.user?e.user=t.user:(location.hash="#/tab/index",location.reload()),e.cashierid=r.cashierid,"undefined"==typeof e.cashierid&&(location.hash="#/tab/index",location.reload()),e.records=[],e.timeout=0,e.count=0,e.balancePay=0,e.balanceBtnCheck=!1,e.wxHide=!1,t.showLoading("加载中"),o.get("/cashier/getCashier?cashierid="+e.cashierid).success(function(t){if(200===t.code){(0==t.data.length||1==t.data[0].isPay)&&(location.hash="#/tab/index",location.reload()),e.records=t.data,e.records.length>0&&(e.timeout=e.records[0].timeout);for(var o=0;o<e.records.length;o++)e.count+=parseInt(e.records[o].count);n(function(){e.timeout<=0&&(location.hash="#/tab/index",location.reload()),e.timeout--},1e3)}}).error(function(e){console.log(e)})["finally"](function(){t.hideLoading()}),e.chooseBalance=function(){e.balanceBtnCheck?(e.balanceBtnCheck=!1,e.balancePay=0,e.wxHide=!1):!e.balanceBtnCheck&&e.user.balance>0&&(e.balanceBtnCheck=!0,e.user.balance>=e.count?(e.balancePay=e.count,e.wxHide=!0):e.balancePay=e.user.balance)},e.pay=function(){t.showLoading("等待中.."),e.count-e.balancePay>0?(t.hideLoading(),window.location.href="/views/mobile/payment.php?cashierid="+e.cashierid+"&fee="+100*(e.count-e.balancePay).toFixed(2)):o.post("/pay",{cashierid:e.cashierid},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(t){window.location.href="#/tab/cart/payresult-"+e.cashierid+"-"+100*(e.count-e.balancePay).toFixed(2)+"-0"}).error(function(e){console.log(e)})["finally"](function(){t.hideLoading()})},e.exit=function(){var e=confirm("您的订单尚未支付，确定要终止支付操作吗？");1==e&&i.goBack()}}]).controller("PayresultCtrl",["$scope","$rootScope","$http","$stateParams","$interval",function(e,t,o,r,n){e.init=!1,e.cashierid=r.cashierid,e.fee=r.fee,e.isCancel=r.isCancel,e.showNumbers=function(e,o,r,n){for(t.title=e,t.term=o,t.numbers=[];n>=r;r++)t.numbers.push(r);t.numberModal.show()},o.get("/user/isLogin").success(function(e){200===e.code?t.user=e.data[0]:(location.hash="#/tab/index",location.reload())}),"undefined"==typeof e.cashierid&&(location.hash="#/tab/index",location.reload()),e.successOrders=[],e.failOrders=[],e.successCount=0,t.showLoading("加载中.."),e.timer=n(function(){o.get("/cashier/getDetailMobile?cashierid="+e.cashierid).success(function(o){if(200==o.code&&!e.init&&(1==e.isCancel||o.data.length>0&&2==o.data[0].payStatus)){n.cancel(e.timer),e.isPay=o.data.length>0?1:0,o=o.data;for(var r=0,i=o.length;i>r;r++)1==o[r].status?(e.successOrders.push(o[r]),e.successCount+=parseInt(o[r].count)):e.failOrders.push(o[r]);t.hideLoading(),e.init=!0}}).error(function(e){console.log(e)})},2e3),e.repay=function(){location.href="/views/mobile/payment.php?cashierid="+e.cashierid+"&fee="+e.fee},e.backToIndex=function(){location.href="/mobile.html#/tab/index",location.reload()},e.backToProfile=function(e){location.href="/mobile.html#/tab/profile?location="+e,location.reload()}}]),angular.module("YYYG").controller("ProfileCtrl",["$scope","$rootScope","$http","$ionicModal","Service","UserService",function(e,t,o,r,n,i){var a=function(e){var t=window.location.href.split("?");if(2==t.length){for(var o=t[1].split("&"),r=[],n=0,i=o.length;i>n;n++)if(r=o[n].split("="),2==r.length&&r[0]==e)return r[1];return null}return null},s=a("location");e.signed=!1,n.checkLogin(function(){n.isLogin&&(e.user=n.user,i.wx(n.user,function(){e.pointer=!0}),null!=s&&(location.hash="#/tab/profile/"+s))}),e.toggle=function(){e.signed=!e.signed},r.fromTemplateUrl("/public/tpls/mobile/modal/modal-profile-share.html",{scope:e}).then(function(e){t.shareModel=e}),e.pointer=!0,e.share=function(){e.pointer=!e.pointer},e.openRedPackage=function(o){t.user?i.getHbRecords(function(o){e.records=o,t.shareModel.show()}):t.checkLoginAndModal(o)},e.form={},e.save=function(){e.form.emptyError=!1,e.form.sameError=!1,e.form.uniqueError=!1,e.form.pswError=!1,"undefined"==typeof e.form.psw||"undefined"==typeof e.form.newPsw||"undefined"==typeof e.form.newPsw2?e.form.emptyError=!0:e.form.newPsw!=e.form.newPsw2?e.form.uniqueError=!0:e.form.newPsw==e.form.psw?e.form.sameError=!0:o.post("/user/updatePassword",{oldpwd:e.form.psw,newpwd:e.form.newPsw},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(t){200==t.code?(alert("密码修改成功"),location.hash="#/tab/profile"):e.form.pswError=!0}).error(function(e){console.log(e)})}}]).controller("CreditCtrl",["$scope","$rootScope","$http","$ionicPopup","Service","UserService",function(e,t,o,r,n,i){e.init=!1,t.showLoading("加载中.."),n.checkLogin(function(){n.isLogin?(e.user=n.user,e.amount=parseInt(e.user.credits)):window.location.hash="#/tab/profile"}),i.checkSignIn(function(){e.isSignIn=i.isSignIn,e.init=!0,t.hideLoading()}),e.signIn=function(){i.signIn(function(t){e.isSignIn=i.isSignIn,e.user.credits=parseInt(e.user.credits)+t})},e.exchange=function(){if(e.user.credits<100)return void alert("积分不足,无法兑换");var t=confirm("你确定要兑换全部积分吗");if(t){var r=100*parseInt(e.user.credits/100);o.post("/credit/exchange",{amount:r},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(t){200==t.code&&(e.user.balance=t.data.balance,e.user.credits=t.data.credits)}).error(function(e){console.log(e)})}}}]).controller("CreditRecordCtrl",["$scope","$rootScope","Service","UserService",function(e,t,o,r){Array.prototype.unique=function(){for(var e=this,t={},o=[],r=0;r<e.length;r++)"undefined"==typeof t[e[r].id]&&(t[e[r].id]=!0,o.push(e[r]));return o},e.records=[],e.init=!1,e.hasMoreData=!0,e.page=1,e.limit=10,e.isRefresh=!1,e.getCredit=function(){e.init||t.showLoading("加载中.."),r.getCredit(function(o){o.length<10&&(e.hasMoreData=!1),e.isRefresh&&(e.records=[]),e.records=e.records.concat(o),e.records=e.records.unique(),1!=e.page||e.init?e.isRefresh?(e.$broadcast("scroll.refreshComplete"),e.isRefresh=!1):e.$broadcast("scroll.infiniteScrollComplete"):(t.hideLoading(),e.init=!0),e.page++},e.limit,e.page)},o.checkLogin(function(){o.isLogin?e.getCredit():(window.location.hash="/mobile.html#tab/index.html",window.location.reload())}),e.doRefresh=function(){e.page=1,e.isRefresh=!0,e.hasMoreData=!0,e.getCredit()}}]).controller("RechargeCtrl",["$scope","$rootScope","Service",function(e,t,o){o.checkLogin(function(){0==o.isLogin?window.location.hash="/mobile.html#/tab/index.html":e.user=o.user}),e.recharge_list=[10,20,50,100,200],e.current_select=0,e.recharge_number=10,e.tmp={},e.tmp.input_number=void 0,e.select=function(t){e.current_select=t,5>t?e.recharge_number=e.recharge_list[t]:jQuery("input.inputNum").select()},e.checkNumber=function(t){!parseInt(t)||parseInt(t)<=0?(e.tmp.input_number=1,e.recharge_number=1):(e.tmp.input_number=parseInt(t),e.recharge_number=parseInt(t))},e.pay=function(){t.showLoading("等待中.."),window.location.href="/views/mobile/recharge.php?fee="+100*e.recharge_number,t.hideLoading()}}]).controller("RechargeResultCtrl",["$scope","$rootScope","$stateParams","Service","UserService",function(e,t,o,r,n){e.init=!1,r.checkLogin(function(){r.isLogin||(location.href="/mobile.html#/tab/index",location.reload())}),e.tradeId=o.tradeId,e.fee=o.fee,e.isCancel=o.isCancel,e.repay=function(){location.href="/views/mobile/recharge.php?fee="+e.fee},e.backToIndex=function(){location.href="/mobile.html#/tab/index",location.reload()},e.backToProfile=function(){location.href="/mobile.html#/tab/profile?location=balance"},1==e.isCancel?(e.isPay=0,e.init=!0):(t.showLoading("加载中.."),n.rechargeReady(function(){e.isPay=1,e.init=!0,t.hideLoading()},e.tradeId))}]).controller("recordBuyCtrl",["$scope","$rootScope","$http","$ionicScrollDelegate","YungouService",function(e,t,o,r,n){e.allRecords=e.remainRecords=e.finishRecords=[],e.hasMoreDataOfAll=e.hasMoreDataOfRemain=e.hasMoreDataOfFinish=!0,e.allRecordPage=e.remainRecordPage=e.finishRecordPage=1,e.initAll=e.initRemain=e.initFinish=!1,e.toLatestYungou=function(e){n.getLatestYungou(function(e){window.location.hash="#/tab/profile/yungou-"+e+"-"+t.timeStamp},e)},e.getAllRecord=function(){1!=e.allRecordPage||e.initAll||t.showLoading("加载中.."),e.hasMoreDataOfAll&&o.get("/order/getRecord?limit=10&page="+e.allRecordPage).success(function(t){200==t.code&&(e.initAll=!0,1==e.allRecordPage&&(e.allRecords=[]),e.allRecordPage++,t.data.length<10&&(e.hasMoreDataOfAll=!1),e.allRecords=e.allRecords.concat(t.data),r.resize())}).error(function(e){console.log(e)})["finally"](function(){2==e.allRecordPage?(t.hideLoading(),e.$broadcast("scroll.refreshComplete")):e.$broadcast("scroll.infiniteScrollComplete")})},e.getRemainRecord=function(){1!=e.remainRecordPage||e.initRemain||t.showLoading("加载中.."),e.hasMoreDataOfRemain&&o.get("/order/getRecord?limit=10&page="+e.remainRecordPage+"&status=3").success(function(t){200==t.code&&(e.initRemain=!0,1==e.remainRecordPage&&(e.remainRecords=[]),e.remainRecordPage++,t.data.length<10&&(e.hasMoreDataOfRemain=!1),e.remainRecords=e.remainRecords.concat(t.data),r.resize())}).error(function(e){console.log(e)})["finally"](function(){2==e.remainRecordPage?(t.hideLoading(),e.$broadcast("scroll.refreshComplete")):e.$broadcast("scroll.infiniteScrollComplete")})},e.getFinishRecord=function(){1!=e.finishRecordPage||e.initFinish||t.showLoading("加载中.."),e.hasMoreDataOfFinish&&o.get("/order/getRecord?limit=10&page="+e.finishRecordPage+"&status=2").success(function(t){200==t.code&&(e.initFinish=!0,1==e.finishRecordPage&&(e.finishRecords=[]),e.finishRecordPage++,t.data.length<10&&(e.hasMoreDataOfFinish=!1),e.finishRecords=e.finishRecords.concat(t.data),r.resize())}).error(function(e){console.log(e)})["finally"](function(){2==e.finishRecordPage?(t.hideLoading(),e.$broadcast("scroll.refreshComplete")):e.$broadcast("scroll.infiniteScrollComplete")})},e.doRefresh=function(){switch(e.currentStatus){case 0:e.allRecordPage=1,e.hasMoreDataOfAll=!0,e.getAllRecord();break;case 1:e.remainRecordPage=1,e.hasMoreDataOfRemain=!0,e.getRemainRecord();break;case 2:e.finishRecordPage=1,e.hasMoreDataOfFinish=!0,e.getFinishRecord()}},e.currentStatus=0,e.changeStatus=function(t){switch(e.currentStatus!=t&&r.scrollTop(!1),e.currentStatus=t,t){case 0:e.initAll||e.getAllRecord();break;case 1:e.initRemain||e.getRemainRecord();break;case 2:e.initFinish||e.getFinishRecord()}},t.user?e.changeStatus(0):(location.hash="#/tab/index",location.reload())}]).controller("ProfileSettingCtrl",["$scope","$rootScope","$http","$ionicActionSheet",function(e,t,o,r){e.nickNameHide=!0,e.inputNickName=function(){e.nickNameHide=!1},e.cancelNickName=function(){e.nickNameHide=!0,e.nickName=e.user.userName},e.updateNickName=function(){""!=e.nickName&&(t.showLoading("修改中.."),o.post("/user/updateNickname",{nickname:e.nickName},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(o){200==o.code&&(e.nickNameHide=!0,t.user.userName=e.nickName)}).error(function(e){console.log(e)})["finally"](function(){t.hideLoading()}))},o.get("/user/isLogin").success(function(o){200===o.code?(t.user=o.data[0],e.user=t.user,t.getCart(),e.nickName=e.user.userName):window.location.hash="#/tab/profile"}),e.updateAvatar=function(){jQuery("#cameraInput").click()};var n=function(e){var t=function(e){var t=["jpg","png","jpeg","bmp"];return 2==e.length&&e[1]in t},o=function(e){return 65535>e},r=e.name.split("."),n=e.size;return!0};e.uploadFile=function(e){if(!n(e[0]))return void alert("图片格式错误或图片太大");t.showLoading("上传中..");var o=function(e){var o=e.target.responseText;o=JSON.parse(o),200==o.code&&(t.user.avatorUrl=o.data,t.hideLoading())},r=new FormData;r.append("file",e[0]);var i=new XMLHttpRequest;i.open("POST","/uploader/user_avatorUrl"),i.addEventListener("load",o,!1),i.send(r)},e.logout=function(){o.get("/user/logout").success(function(e){200===e.code&&(window.location.hash="#/tab/index",window.location.reload())})}}]).controller("winDetailCtrl",["$scope","$rootScope","$stateParams","$http","$ionicPopup","Service",function(e,t,o,r,n,i){e.winOrderId=o.winOrderId,e.getWinOrder=function(){t.showLoading("加载中.."),r.get("/winOrder/getById?winOrderId="+e.winOrderId).success(function(t){console.log(t),200==t.code?e.record=t.data:window.location.hash="#/tab/profile"}).error(function(e){console.log(e)})["finally"](function(){t.hideLoading()})},i.checkLogin(function(){i.isLogin?e.getWinOrder():window.location.hash="#/tab/profile"}),e.showConfirm=function(){var t=window.confirm("您确认收到中奖商品了么？");t&&r.post("/winOrder/confirm",{winOrderId:e.winOrderId},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(t){200==t.code&&e.getWinOrder()}).error(function(e){console.log(e)})}}]).controller("BalanceCtrl",["$scope","$rootScope","$http","Service","UserService",function(e,t,o,r,n){Array.prototype.unique=function(){for(var e=this,t={},o=[],r=0;r<e.length;r++)"undefined"==typeof t[e[r].id]&&(t[e[r].id]=!0,o.push(e[r]));return o},e.records=[],e.init=!1,e.hasMoreData=!0,e.page=1,e.limit=10,e.isRefresh=!1,e.getBalance=function(){e.init||t.showLoading("加载中.."),n.getBalance(function(o){o.length<10&&(e.hasMoreData=!1),e.isRefresh&&(e.records=[]),e.records=e.records.concat(o),e.records=e.records.unique(),1!=e.page||e.init?e.isRefresh?(e.$broadcast("scroll.refreshComplete"),e.isRefresh=!1):e.$broadcast("scroll.infiniteScrollComplete"):(t.hideLoading(),e.init=!0),e.page++},e.limit,e.page)},r.checkLogin(function(){r.isLogin?e.getBalance():(window.location.hash="/mobile.html#tab/index.html",window.location.reload())}),e.doRefresh=function(){e.page=1,e.isRefresh=!0,e.hasMoreData=!0,e.getBalance()}}]).controller("UserRecordCtrl",["$scope","$rootScope","$http","$stateParams","$ionicScrollDelegate","YungouService",function(e,t,o,r,n,i){e.uid=r.uid,e.records=[],e.hasMoreDataOfRecords=!0,e.recordsPage=1,e.initOfRecords=!1,e.winRecords=[],e.hasMoreDataOfWinRecords=!0,e.winRecordsPage=1,e.initOfWinRecords=!1,e.shows=[],e.hasMoreDataOfShows=!0,e.showsPage=1,e.initOfShows=!1,e.otherUser={},e.toYungou=function(t){window.location.hash="#/tab/"+e.activedTab+"/yungou-"+t+"-"+e.timeStamp},e.toLatestYungou=function(t){i.getLatestYungou(function(t){window.location.hash="#/tab/"+e.activedTab+"/yungou-"+t+"-"+e.timeStamp},t)},e.current_item=0,e.current_bodyWidth=document.body.offsetWidth,e.selectItem=function(t){switch(e.current_item!=t&&n.scrollTop(!1),e.current_item=t,t){case 0:e.initOfRecords||e.getRecord();break;case 1:e.initOfWinRecords||e.getWinRecord();break;case 2:e.initOfShows||e.getShow()}},t.showLoading("加载中.."),o.get("/user/getUserMobile?uid="+e.uid).success(function(t){200==t.code&&(e.otherUser=t.data[0])}).error(function(e){console.log(e)})["finally"](function(){t.hideLoading(),e.selectItem(0)}),e.doRefresh=function(){switch(e.current_item){case 0:e.recordsPage=1,e.hasMoreDataOfRecords=!0,e.getRecord();break;case 1:e.winRecordsPage=1,e.hasMoreDataOfWinRecords=!0,e.getWinRecord();break;case 2:e.showsPage=1,e.hasMoreDataOfShows=!0,e.getShow()}},e.getRecord=function(){1!=e.recordsPage||e.initOfRecords||t.showLoading("加载中.."),e.hasMoreDataOfRecords&&o.get("/order/getRecord?page="+e.recordsPage+"&limit=10&id="+e.uid).success(function(t){200==t.code&&(e.initOfRecords=!0,1==e.recordsPage&&(e.records=[]),e.recordsPage++,t.data.length<10&&(e.hasMoreDataOfRecords=!1),e.records=e.records.concat(t.data),n.resize())}).error(function(e){console.log(e)})["finally"](function(){2==e.recordsPage?(t.hideLoading(),e.$broadcast("scroll.refreshComplete")):e.$broadcast("scroll.infiniteScrollComplete")})},e.getWinRecord=function(){1!=e.winRecordsPage||e.initOfWinRecords||t.showLoading("加载中.."),e.hasMoreDataOfWinRecords&&o.get("/order/getWinRecord?page="+e.winRecordsPage+"&limit=10&id="+e.uid).success(function(t){200==t.code&&(e.initOfWinRecords=!0,1==e.winRecordsPage&&(e.winRecords=[]),e.winRecordsPage++,t.data.length<10&&(e.hasMoreDataOfWinRecords=!1),e.winRecords=e.winRecords.concat(t.data),n.resize())}).error(function(e){console.log(e)})["finally"](function(){2==e.winRecordsPage?(t.hideLoading(),e.$broadcast("scroll.refreshComplete")):e.$broadcast("scroll.infiniteScrollComplete")})},e.getShow=function(){1!=e.showsPage||e.initOfShows||t.showLoading("加载中.."),e.hasMoreDataOfShows&&o.get("/show/getAllByUser?limit=10&page="+e.showsPage+"&userId="+e.uid).success(function(t){200==t.code&&(e.initOfShows=!0,1==e.showsPage&&(e.shows=[]),e.showsPage++,t.data.length<10&&(e.hasMoreDataOfShows=!1),e.shows=e.shows.concat(t.data),n.resize())}).error(function(e){console.log(e)})["finally"](function(){2==e.showsPage?(t.hideLoading(),e.$broadcast("scroll.refreshComplete")):e.$broadcast("scroll.infiniteScrollComplete")})}}]).controller("recordWinCtrl",["$scope","$rootScope","$http","Service",function(e,t,o,r){e.records=[],e.page=1,e.hasMoreData=!0,e.isRefresh=!1,e.isLoad=!1,e.init=!1,e.getWinRecord=function(){1==e.page&&t.showLoading("加载中.."),e.hasMoreData&&o.get("/order/getWinRecord?page="+e.page+"&limit=10").success(function(t){200==t.code&&(1==e.page&&(e.records=[]),e.page++,t.data.length<10&&(e.hasMoreData=!1),e.records=e.records.concat(t.data))}).error(function(e){console.log(e)})["finally"](function(){2==e.page&&t.hideLoading(),e.isRefresh&&e.$broadcast("scroll.refreshComplete"),e.isLoad&&e.$broadcast("scroll.infiniteScrollComplete"),e.init=!0})},r.checkLogin(function(){r.isLogin?e.getWinRecord():window.location.hash="#/tab/profile"}),e.doRefresh=function(){e.page=1,e.hasMoreData=!0,e.isRefresh=!0,e.getWinRecord()},e.loadMoreData=function(){e.isLoad=!0,e.getWinRecord()}}]).controller("addressCtrl",["$scope","$rootScope","$http","$stateParams","$ionicPopup","$ionicHistory","Service","AddressService",function(e,t,o,r,n,i,a,s){e.comeFromProfile=!1,e.winOrderId=r.winOrderId,e.selectAddressId=-1,e.viewTitle="地址列表",a.checkLogin(function(){a.isLogin||(window.location.hash="#/tab/profile")}),t.showLoading("加载中.."),s.getAll(function(){e.addresses=s.addresses;for(var o=0,r=e.addresses.length;r>o;o++)1==e.addresses[o].status&&(e.selectAddressId=e.addresses[o].id);t.hideLoading()}),e.modifyAddress=function(e){location.href="/mobile.html#/tab/profile/addressEdit-"+e},e.selectAddress=function(t){e.selectAddressId=t},e.editAddress=function(){},e.showConfirm=function(){if(-1==e.selectAddressId)return void alert("您还没有选择地址");var t=confirm("您确定是这个地址了么?");t&&o.get("/winOrder/confirmAddress?winOrderId="+e.winOrderId+"&addressId="+e.selectAddressId).success(function(e){200==e.code&&i.goBack()}).error(function(e){console.log(e)})},e.addAddress=function(){e.addresses.length>=5?alert("地址不能超过5条"):window.location.hash="#/tab/profile/addressEdit-0"}}]).controller("AddressCtrl",["$scope","$rootScope","Service","AddressService",function(e,t,o,r){e.viewTitle="地址列表",o.checkLogin(function(){o.isLogin||(window.location.hash="#/tab/profile")}),e.comeFromProfile=!0,t.showLoading("加载中.."),r.getAll(function(){e.addresses=r.addresses,t.hideLoading()}),e.addAddress=function(){e.addresses.length>=5?alert("地址不能超过5条"):window.location.hash="#/tab/profile/addressEdit-0"},e.editAddress=function(e){t.editAddress=clone(e),window.location.hash="#/tab/profile/addressEdit-"+e.id}}]).controller("AddressEditCtrl",["$scope","$rootScope","$stateParams","$ionicHistory","Service","AddressService",function(e,t,o,r,n,i){function a(){i.getCities(e.address.provinceID,function(){e.cities=i.cities})}function s(){i.getAreas(e.address.cityID,function(){e.areas=i.areas})}e.addressId=o.addressId,n.checkLogin(function(){n.isLogin||(window.location.hash="#/tab/profile")}),0==e.addressId?(e.viewTitle="添加地址",e.deleteText="",e.address={}):(e.viewTitle="编辑地址",e.deleteText="删除",t.editAddress?(e.address=t.editAddress,a(),s()):window.location.hash="#/tab/profile/address"),i.getProvinces(function(){e.provinces=i.provinces}),e.selectProvince=function(){e.address.cityID=void 0,e.address.areaID=void 0,a()},e.selectCity=function(){e.address.areaID=void 0,s()},e.saveAddress=function(){e.address.status||(e.address.status=0),e.address.receiver&&e.address.phoneNumber&&e.address.provinceID&&e.address.cityID&&e.address.areaID&&e.address.street?0!=e.addressId?e.updateAddress():(t.showLoading("保存中.."),i.addAddress(e.address,function(e,o){t.hideLoading(),e?r.goBack():alert(405===o?"地址不能超过5条，添加失败。":"地址信息不完整或格式不正确")})):alert("地址信息不完整或格式不正确")},e.updateAddress=function(){t.showLoading("保存中.."),i.updateAddress(e.address,function(e){t.hideLoading(),e?r.goBack():alert("地址信息不完整或格式不正确")})},e.deleteAddress=function(){if(0==e.addressId)return void r.goBack();var o=confirm("确定删除地址？");1==o&&(t.showLoading("删除中.."),i.deleteAddress(t.editAddress.id,function(e){t.hideLoading(),e?r.goBack():alert("删除出错！")}))}}]).controller("exposeCtrl",["$scope","$rootScope","$http","Service",function(e,t,o,r){e.remainRecords=[],e.finishRecords=[],e.finishRecordPage=1,e.remainRecordPage=1,e.hasMoreDataOfFinish=!0,e.hasMoreDataOfRemain=!0,e.isRefresh=!1,e.isLoad=!1,e.getRemain=function(){1!=e.remainRecordPage||e.isRefresh||t.showLoading("加载中.."),o.get("/show/getUnshowByUser?limit=10&page="+e.remainRecordPage).success(function(t){200==t.code&&(1==e.remainRecordPage&&(e.remainRecords=[]),e.remainRecordPage++,e.remainRecords=e.remainRecords.concat(t.data),t.data.length<10&&(e.hasMoreDataOfRemain=!1))}).error(function(e){console.log(e)})["finally"](function(){e.isRefresh&&(e.$broadcast("scroll.refreshComplete"),e.isRefresh=!1),e.isLoad&&(e.$broadcast("scroll.infiniteScrollComplete"),e.isLoad=!1),2==e.remainRecordPage&&e.hasMoreDataOfRemain&&!e.isRefresh&&t.hideLoading(),e.hasMoreDataOfRemain||e.getFinish(10-e.remainRecords.length%10)})},e.getFinish=function(r){o.get("/show/getAllByUser?limit="+r+"&page="+e.finishRecordPage).success(function(t){200==t.code&&(1==e.finishRecordPage&&(e.finishRecords=[]),e.finishRecordPage++,e.finishRecords=e.finishRecords.concat(t.data),t.data.length<10&&(e.hasMoreDataOfFinish=!1))}).error(function(e){console.log(e)})["finally"](function(){e.isRefresh&&(e.$broadcast("scroll.refreshComplete"),e.isRefresh=!1),e.isLoad&&(e.$broadcast("scroll.infiniteScrollComplete"),e.isLoad=!1),2!=e.finishRecordPage||2!=e.remainRecordPage||e.isRefresh||t.hideLoading()})},e.doRefresh=function(){e.finishRecordPage=1,e.remainRecordPage=1,e.hasMoreDataOfFinish=!0,e.hasMoreDataOfRemain=!0,e.isRefresh=!0,e.getRemain()},e.toIndex=function(){window.location.hash="#/tab/index"},e.toAddShow=function(e){window.location.hash="#tab/profile/expose/add-"+e},e.loadMoreData=function(){console.log(1),e.isLoad=!0,e.hasMoreDataOfRemain?e.getFinish(10):e.getRemain()},r.checkLogin(function(){r.isLogin?e.getRemain():window.location.hash="#/tab/profile"}),e.addressCount=1,"0"===location.href.split("?").pop()&&(e.addressCount=0)}]).controller("exposeAddCtrl",["$window","$stateParams","$scope","$rootScope","$ionicActionSheet","$timeout","$http",function(e,t,o,r,n,i,a){o.yungouId=t.yid,o.exposeImgList=[],o.show={};var s=[],c=[],l=new FileReader;o.uploadFile=function(e){l.onload=function(e){o.exposeImgList.push(e.target.result),r.hideLoading()};for(var t=!1,n=0,i=s.length;i>n;n++)if(s[n].name==e[0].name&&s[n].size==e[0].size){t=!0;break}t||(r.showLoading("上传中.."),s.push(e[0]),l.readAsDataURL(e[0]))},o.add=function(){if("undefined"==typeof o.show.showTitle||"undefined"==typeof o.show.showContent||o.show.showTitle.length<4||o.show.showTitle.length>20||o.show.showContent.length<15||o.show.showContent.length>255)alert("标题或内容字符数不正确");else if(0==s.length||s.length>=5)alert("图片不能为空");else{r.showLoading("发布中..");for(var e=function(e){var o=e.target.responseText;o=JSON.parse(o),200==o.code&&c.push(o.data),c.length==s.length&&t()},t=function(){a.post("/show/add",{title:o.show.showTitle,content:o.show.showContent,imgUrls:c.join(","),yungouId:o.yungouId,orderId:o.record.orderId,term:o.record.term},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e){200==e.code&&(r.hideLoading(),location.href="#/tab/profile/expose/success-"+o.yungouId,r.isExposeAdd=!0)}).error(function(e){console.log(e)})},n=0;n<s.length;n++){var i=new FormData;i.append("file",s[n]);var l=new XMLHttpRequest;l.open("POST","/uploader/show"),l.addEventListener("load",e,!1),l.send(i)}}},r.showLoading("加载中.."),a.get("/yungou/getYgForShow?yid="+o.yungouId).success(function(e){200==e.code&&(o.record=e.data)}).error(function(e){console.log(e)})["finally"](function(){r.hideLoading()}),o.deleteOneExposeImg=function(e,t){r.showLoading("删除中.."),o.exposeImgList.splice(e,1),s.splice(e,1),$("#cameraInput").val(""),r.hideLoading(),t.stopPropagation()},o.scrollToTop=function(){window.scrollTo(0,0)}}]).controller("exposeSuccessCtrl",["$scope","$stateParams","$rootScope","$http","Service",function(e,t,o,r,n){e.yid=t.yid,n.checkLogin(function(){0==n.isLogin?(location.hash="#/tab/index?",location.reload()):e.user=n.user}),"undefined"!=typeof o.isExposeAdd&&o.isExposeAdd?o.isExposeAdd=!1:(window.location.hash="#/tab/index",window.location.reload())}]).controller("AgencyCtrl",["$scope","$http","$ionicModal",function(e,t,o){t.get("/delegate/getMemberNumAndCash").success(function(t){200==t.code&&(e.member=t.data)}).error(function(e){console.log(e)}),t.get("/delegate/getThisMonthStatics").success(function(t){200==t.code&&(e.month=t.data)}).error(function(e){console.log(e)}),e.getWithdrawRecords=function(){t.get("/delegate/getWithdrawRecords?isapproved=2&page=1&limit=5").success(function(t){console.log(t),200==t.code&&(e.withdraw=t.data)}).error(function(e){console.log(e)})},e.getWithdrawRecords(),e.withdrawFn=function(){e.money=$("#typeIn").val(),"undefined"!=typeof e.member&&e.money<=e.member.cash&&e.money>10&&t.post("/delegate/applyWithdraw",{amount:e.money},{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(t){200==t.code&&(e.modal.hide(),e.getWithdrawRecords())}).error(function(e){console.log(e)})},o.fromTemplateUrl("/public/tpls/mobile/modal/modal-agency-withdraw.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t})}]).controller("SuggestCtrl",["$scope","$rootScope","$http","Service",function(e,t,o,r){r.checkLogin(function(){0==r.isLogin&&(window.location.hash="#tab/profile",
window.location.reload())}),e.data={},e.data.theme="1",e.saveSuggest=function(){e.data.contentError=!1,"undefined"==typeof e.data.email&&(e.data.email=""),"undefined"==typeof e.data.content||e.data.content.length<12||e.data.content.length>200?e.data.contentError=!0:o.post("/user/suggest",e.data,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e){200==e.code&&(alert("提交成功"),window.location.hash="#tab/profile",window.location.reload())})}}]).controller("HelpCtrl",["$scope","$rootScope","$http","Service",function(e,t,o,r){r.checkLogin(function(){0==r.isLogin&&(window.location.hash="#tab/profile",window.location.reload())})}]);